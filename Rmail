Rmail is the default mail reader for GNU Emacs.  With it you can read
multiple local and remote inboxes.

: Rmail is the primary Emacs mail-reader. 
I will ignore any suggestion to treat it
as unimportant. --- [[RichardStallman|Stallman]]
[http://lists.gnu.org/archive/html/emacs-devel/2004-09/msg00328.html]

See GettingMail, WritingMail, and SendingMail for more setup examples.

== Configuration ==

You should download the `mailutils' package on your computer if you
want the best rmail experience.

Here is a detailed Rmail configuration. A simpler example is in [[GettingMail]].

<pre>
(setq
 ;; The mail URL, specifying a remote mail account
 ;; (Omit this to read from /var/mail/user)
 rmail-inbox-list
  '("pop://me%40example.com:Passw0rD@mail.example.com"))

 send-mail-function 'smtpmail-send-it       ; Send mail via SMTP
 rmail-preserve-inbox 1                     ; Don't delete mail from server
 rmail-mail-new-frame 1                     ; Compose in a full frame
 rmail-delete-after-output 1                ; Delete original mail after copying
 rmail-mime-prefer-html nil                 ; Prefer plaintext when possible
 rmail-file-name   "~/mail/inbox"           ; The path to our inbox file
 rmail-secondary-file-directory "~/mail"    ; The path to our other mbox files
 message-default-headers "Fcc: ~/mail/sent" ; Copy sent mail to the "sent" file
 user-full-name    "Susan"                  ; Our full name
 user-mail-address "me@example.com"         ; Our return address
 message-signature "Plop! -S")              ; A signature
</pre>

You can also decide how rmail handles HTML emails with the `shr'
variables:

<pre>
(setq
 shr-use-fonts nil  ; Don't load fancy fonts
 shr-indentation 2  ; A left-margin of 2 columns
 shr-use-colors nil ; Don't load special colors
 shr-width 70       ; Fix width to 70 columns
 shr-bullet "• ")   ; A bullet character for <li> elements
</pre>

Note that the `shr' variables also apply to [[eww]]

== Basic Usage ==

Start rmail with `M-x rmail'. With no configuration, this attempts to
move all your mail from your local spool file to the Rmail primary
file pointed by `rmail-file-name' (defaults to ##~/RMAIL##)

Some helpful keys:

* <code>?</code> - Full list of keybindings
* <code>n</code> - Next message
* <code>p</code> - Previous message
* <code>d</code> - Mark current message for deletion
* <code>u</code> - Unmark current message
* <code>x</code> - Delete all marked messages
* <code>r</code> - Reply
* <code>m</code> - Compose a new email
* <code>o</code> - Output mail to an mbox file
* <code>i</code> - Open an mbox file
* <code>a</code> - Add label to current message
* <code>l</code> - Filter inbox by label
* <code>M-s</code> - Search all mail (also see [[MairixSearch]])

== Reading mail ==

* The `h' key makes a message list (*summary*) appear.
* Select the next/previous message with `n' and `p'.
* Use `Spacebar' and `Backspace' to scroll through the current message.

You can tell how many messages you want to appear in the summary
buffer with `rmail-summary-window-size'.

=== Mailing lists ===

Use the handy command `M-x undigestify-rmail-message' when viewing a
mailing list digest to split it into separate messages.  The original
message is marked for deletion.

== Writing mail ==

To start writing a new message, you can use `C-x m' or `M-x mail' from
anywhere in Emacs.

If you are in an rmail buffer, just press `m' to create a new mail, `r' to
reply to a message, or `f' to forward a message.

By default, rmail uses [[MailMode]] for composition. You can change
this by setting the `mail-user-agent' variable:

<pre>
;; Use Mail mode to compose messages (default)
(setq mail-user-agent 'sendmail-user-agent)

;; To use Message mode instead:
(setq mail-user-agent 'message-user-agent)
</pre>

== Sending Mail ==

While composing a message, *send* it with ##C-c C-s##.

You can use a different MTA (like ##msmtp##) to handle sending:

{{{
(setq
  message-send-mail-function 'message-send-mail-with-sendmail
  sendmail-program "/usr/bin/msmtp")
}}}

== Sorting mail ==

The two major sorting methods in rmail are '''labels''' and '''files'''.

=== Labels ===

You can add one or more *labels* to a message. You can *filter* your inbox to only display certain labels.

* `a' - Add a label, or multiple separated by a comma
* `k' - Remove label
* `l' - Sort by label

=== Mbox Files ===

You can move your mail from the *inbox* to different *mbox files* (like ##family##, ##work##, etc). These mbox files behave *exactly the same* as the inbox. 

* `o' - Output message to an mbox file
* `i' - Visit an mbox file

`rmail-output-file-alist' lets you set default files for specified
email addresses, so you don't have to type the name of the file each time you
press `o'.  If you set `rmail-automatic-folder-directives', filing happens
automatically after the mail is received from the inbox.

== Storing Passwords ==

You can store your full inbox string in ##~/.mu-tickets## like so: 

{{{
pop://me%40example.com:Passw0rD@mail.example.com
}}}

Then, in ##rmail-primary-inbox-list##, you can omit the password field:

{{{
pop://me%40example.com@mail.example.com
}}}

Alternatively, you may store the whole string in the ##MAIL## environment variable and leave ##rmail-primary-inbox-list## as ##nil##.

: (TODO - Specify how to encrypt the locally-stored password)

== Mail Aliases ==

You can create aliases by using this form in ##~/.mailrc##:

{{{
alias me  "Me <me@example.com>"
alias you "You <you@example.com"
}}}

Then simply write ##me## in the ##To: ## field then press ##TAB## to expand it to ##Me <me@example.com>##.

You can also set ##mail-personal-alias-file## to specify a different file than ##~/.mailrc##

== Non-ASCII Mail ==

Emacs comes with ##rfc2047.el## to parse RFC 2047 encoded words:

{{{
;; Should decode the entire message buffer on load
;; Untested (note to self: pls test this, uwu)

(add-hook 'rmail-show-message-hook
	  (lambda ()
            (rfc2047-decode-region
	     (point-min)
	     (point-max) t)))
}}}

== Editing Messages ==

Pressing `e' in an rmail buffer puts you in *editing mode*.  If you
accidentally got there, press `C-c C-]' to abort.  Otherwise, make your changes,
then press `C-c C-c' to save them and return to reading mode.

== Extensions ==

* You can display attachments using RmailMime.
* Lisp:rmail-extras.el - Read mail from remote inboxes using ange-ftp
* [http://ftp.ccs.neu.edu/pub/people/ratinox/emacs-lisp/trmail.el trmail] - Threads in rmail
* RmailConversationSummary - conversation view à la Gmail (no threading)
* Lisp:rmailgen.el - Generate guesses for output and FCC files 
* Lisp:rmail-saver.el - Save single messages to files
* RmailSortHeaders - Always show headers in the same order
* Filter out spam with RmailSpamFilter or RmailSpamprobe.

== Other Formats ==

Rmail supports //mboxo// files. It does not have support for maildir, mh, mboxd, or other formats. Rmail can convert Babyl files to mboxo, though.

Rmail //used// to store mail in a [[Babyl]] file. As of Emacs 23,
rmail uses a standard [http://web.archive.org/web/20160304055659/http://homepage.ntlworld.com./jonathan.deboynepollard/FGA/mail-mbox-formats.html mbox format]:
mboxo. mboxo performs some irreversible conversions such as replacing
<code>From</code> in the body of a mail with <code>>From</code> if it
occurs at the start of a line.  For most people this is unimportant.

Prior to Emacs 23, rmail used the //babyl// file format. Rmail will automatically convert babyl to mbox, but you can also use `M-x unrmail' or the command-line ##b2m## utility.


== Encryption ==

You can enable TLS encryption with `rmail-movemail-flags':

<pre>
(setq rmail-movemail-flags "--tls")
</pre>

Another possible method is by using Stunnel.

=== Encrypting Emails ===

While writing an email, use `M-x mml-secure-message-sign-encrypt' (`C-c C-m C-e') to mark the email for encryption.

When sent, it will be encrypted *based on the recipient's email address*, if it's linked to their PGP key.

=== Decrypting Emails ===

While reading an encrypted email, you can use `M-x rmail-epa-decrypt' to decrypt the email.

More: [[Decrypting an email in Rmail that itself contains a multipart MIME message|Decrypting a multipart MIME mail]]

== Using an External MRA ==

You can use a *Mail Retrieval Agent* (MRA) other than `movemail' by simply creating a function that calls the command of your choice. This example uses `mpop':

{{{
(defun rmail-my-mra ()
  (interactive)
  (shell-command "echo 'Checking mail...'")
  (shell-command "mpop --half-quiet")
  (rmail-summary))

(add-hook 'rmail-mode-hook
  (lambda ()
    (local-set-key "g" 'rmail-my-mra)))
}}}

From here, you can use `M-x rmail-my-mra' or press `g' from an `rmail' buffer, and Emacs will call `mpop' to retrieve your mail.

== External Links ==

* [https://www.gnu.org/software/emacs/manual/html_node/emacs/Rmail.html The rmail manual]
* [https://cadadr.dreamwidth.org/828.html cadadr's rmail article]
* [https://mutoshack.gitlab.io/posts/actually-using-emacs-rmail.html Muto's Rmail article]
* [http://ruzkuku.com/texts/rmail.html Philip K.'s rmail article]
* [https://ane.iki.fi/2020/09/09/rmail.html  Antoine Kalmbach's article]
* [https://www.stunnel.org/ Stunnel's homepage]

----
CategoryMail
