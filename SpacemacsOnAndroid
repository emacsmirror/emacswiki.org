This page is about how to install, and update, the Spacemacs starter kit in Android Emacs. For an overview of the different alternatives for running emacs on Android, see EmacsOnAndroid.

Android Emacs can be used with various StarterKits, for example Spacemacs and Doom Emacs.

As compared to Doom Emacs on Android, Spacemacs on Android has the advantage, that installation and updates of packages is done completely inside the running emacs, without the need for starting a new emacs process in the running emacs. This is both faster, and does not rely on the capability to start a new emacs process. Android currently does not have official support for letting an application start a new process of itself. So even if emacs may currently be able to start a new version of itself, on your device, this capability may disappear when you upgrade Android to a new version.

=Installation=
To get started install the Termux APK and the Android Emacs APK in [https://sourceforge.net/projects/android-ports-for-gnu-emacs/files/termux/ Sourceforge]. Follow the instructions in the README under the same URL. Do not forget to run:
[code]
$ pkg update && pkg upgrade
[/code]

You may need to install additional packages in Termux, such as <tt>git</tt> and <tt>ssh</tt> (<tt>scp</tt>). To check if they are already available:
[code]
$ which git
$ which scp
[/code]

You will need access to Androids internal storage in Termux:
* Make sure permission 'Files and media' is enabled in Permissions for Termux (Android Settings -> Apps -> Termux -> Permissions).
* In termux run <tt>termux-setup-storage</tt>
* You will be prompted to "Allow Termux access photos, media and files on your device", which you should allow.
* Symbolic links to various folders in Android storage, should now be available in directory <tt>~/storage</tt>.
* The user files (Documents, Download, etc) are also available under <tt>/sdcard</tt>. On my Oneplus, the user files are read only under <tt>storage/shared</tt>, but read/write under <tt>/sdcard</tt>

Now run Android emacs. Start a shell in emacs:
[code]
 M-x shell
[/code]

One can normally use both tilde <tt>'~'</tt> and <tt>$HOME</tt> to refer to emacs home directory, but tilde might not work in certain situations during the Doom Emacs installation or update process, especially when something has failed. But <tt>$HOME</tt> always seems to work.

The default emacs configuration directory is <tt>$HOME/.emacs.d/</tt>

We will install the Doom Emacs files under <tt>$HOME/.emacs.d/</tt>, and our personal config files will be <tt>$HOME/.spacemacs/</tt> and <tt>$HOME/.spacemacs.env/</tt>. These two last files will be created automatically during the installation, if you do not already have them.

It's very convenient to have an external keyboard during the setup and configuration.

* Start emacs.
* In emacs start a shell (<tt>M-x shell</tt>) or eshell (<tt>M-x eshell</tt>).
* Applications may look for fonts in directories <tt>$HOME/fonts</tt> and <tt>$HOME/.local/share/fonts</tt>. Make a symbolic link from one to another, to have a unique font directory:
[code]
M-x shell
$ mkdir -p $HOME/.local/share/fonts
$ ln -s $HOME/.local/share/fonts $HOME/fonts
[/code]

* Download fonts "Source Code Pro" and "Nanum Gothic" from Google Fonts. Unpack them and copy the <tt>.ttf</tt> files to <tt>~/fonts/</tt>

* Install spacemacs:
[code]
$ cd $HOME
$ mv .emacs.d .old.emacs.d; mkdir .emacs.d; git clone https://github.com/syl20bnr/spacemacs $HOME/.emacs.d
[/code]

* Before restarting emacs, edit <tt>$HOME/.emacs.d/early-init.el</tt> to add the following lines, before any significant executable code in that file:
[code]
(when (string-equal system-type "android")
  ;; Add Termux binaries to PATH environment
  ;; It is important that termuxpath is prepended, not appended.
  ;; Otherwise we will get Androids incompatible diff executable, instead of the one in Termux.
  (let ((termuxpath "/data/data/com.termux/files/usr/bin"))
    (setenv "PATH" (format "%s:%s" termuxpath
		       (getenv "PATH")))
    (push termuxpath exec-path)
    (setenv "LANG" "en_US.UTF-8")))  ;; Set LANG to what is configured in Termux.
;; (setq package-check-signature nil)
[/code]

* The LANG environment variable above, should be set to what is convenient for you. Ensure that Termux has the same setting for this environment variable, otherwise there may be problems for some corner cases.
* Restart emacs. Spacemacs should now start, and complete the installation.
* When downloading packages from GNU ELPA, Spacemacs by default relies on a signature key. You may get an error message  similar to the following:
[code]
Failed to verify signature archive-contents.sig:
No public key for 066DAFCB81E42C40 created at 2019-10-02T10:10:02+0100 using RSA
Command output:
gpg: Signature made Wed 02 Oct 2019 10:10:02 AM BST
gpg:                using RSA key C433554766D3DDC64221BFAA066DAFCB81E42C40
gpg: Can't check signature: No public key
[/code]

* You the need to update the signature key:
* Uncomment the line <tt>(setq package-check-signature nil)</tt> in <tt>$HOME/.emacs.d/early-init.el</tt>.
* In <tt>$HOME/.spacemacs</tt> add package <tt>gnu-elpa-keyring-update</tt> to <tt>dotspacemacs-additional-packages</tt>:
[code]
dotspacemacs-additional-packages '(gnu-elpa-keyring-update)
[/code]

* Restart emacs. Spacemacs should now fetch and install the <tt>gnu-elpa-keyring-update</tt> package. Check that the files under <tt>$HOME/.emacs.d/elpa/gnupg</tt> have been updated.
* You should now be able to comment out the line <tt>(setq package-check-signature nil)</tt> in <tt>$HOME/.emacs.d/early-init.el</tt>.

* In <tt>$HOME/.spacemacs</tt> function <tt>dotspacemacs/user-config()</tt> add:
[code]
(remove-hook 'window-setup-hook 'spacemacs/removes-gui-elements)
(remove-hook 'tty-setup-hook 'spacemacs/removes-gui-elements)
(menu-bar-mode 1)
(tool-bar-mode 1)
(tooltip-mode 1)
(setq overriding-text-conversion-style nil)
[/code]

* The last setting should only be used if you are using vim style key bindings, and are sometimes going to use a virtual keyboard. If you do not set it for this case, then you will not be able to enter vim-normal-mode, i.e. all characters will be inserted in the buffer...

CategoryPorts
